<script>
  // Função para pegar o cookie _fbp
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
    return '';
  }

  // Função assíncrona para enviar o evento para a CAPI
  async function sendConversionEvent() {
    console.log('Tentando enviar evento para a CAPI...');
    const fbclid = localStorage.getItem('fbclid') || '';
    const fbp = getCookie('_fbp');
    
    // Monta o corpo da requisição exatamente como a API espera
    const bodyData = {
      event_source_url: window.location.href,
      fbp: fbp,
      fbclid: fbclid,
      user_agent: navigator.userAgent
    };

    try {
      // ✅ USANDO A SUA URL EXATA, CONFIRMADA POR VOCÊ
      const response = await fetch('https://acebook-conversion-api.onrender.com/track', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(bodyData)
      });
      
      if (response.ok) {
        console.log('✅ SUCESSO: Evento enviado para a CAPI.');
      } else {
        const result = await response.json();
        console.error('❌ ERRO na API:', result);
      }
    } catch (error) {
      console.error('❌ ERRO DE CONEXÃO (Fetch falhou):', error);
    }
  }

  // Executa a função de envio assim que a página carrega
  sendConversionEvent();

  // Lógica do contador e redirecionamento (continua igual)
  const link = `https://drive.google.com/drive/folders/1odDv7WZn3cfsXuPrdklo-dWcPeSch8q2`;
  let segundos = 3;
  const contador = document.getElementById("contador");
  const check = document.getElementById("check");
  const interval = setInterval(() => {
    segundos--;
    if (segundos > 0) {
      contador.textContent = segundos;
    } else {
      clearInterval(interval);
      contador.style.display = "none";
      check.style.display = "block";
      setTimeout(() => { window.location.href = link; }, 1000);
    }
  }, 1000);
</script>
